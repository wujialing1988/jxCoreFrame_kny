<?xml version="1.0" encoding="UTF-8"?>
<SqlMap>
	<!-- 设备点检统计分页查询 -->
	<sql id="queryPage2statistic">
		SELECT
			I.IDX,
			I.EQUIPMENT_NAME,
			I.EQUIPMENT_CODE,
			T.CHECK_COUNT,
			T.OMIT_COUNT
		FROM
			(
				SELECT
					A.EQUIPMENT_IDX,
					B.CHECK_COUNT,
					C.OMIT_COUNT
				FROM
					E_SBJX_POINT_CHECK_CATALOG A
				LEFT JOIN (
					SELECT
						T.EQUIPMENT_IDX,
						COUNT(*) CHECK_COUNT
					FROM
						E_SBJX_POINT_CHECK T
					WHERE
						RECORD_STATUS = 0 
					AND STATE = '已处理'
					AND TO_CHAR(T.CHECK_DATE, 'YYYY-MM') = '2016-11'
					GROUP BY
						T.EQUIPMENT_IDX
				) B ON A.EQUIPMENT_IDX = B.EQUIPMENT_IDX
				LEFT JOIN (
					SELECT
						O.EQUIPMENT_IDX,
						COUNT(O.EQUIPMENT_IDX) OMIT_COUNT
					FROM
						E_SBJX_POINT_CHECK_OMIT O
					WHERE TO_CHAR(O.UNCHECK_DATE, 'YYYY-MM') = '2016-11'
					GROUP BY
						O.EQUIPMENT_IDX
				) C ON C.EQUIPMENT_IDX = A.EQUIPMENT_IDX
				WHERE
					A.RECORD_STATUS = 0
			) T,
			E_EQUIPMENT_PRIMARY_INFO I
		WHERE
			I.RECORD_STATUS = 0
		AND T.EQUIPMENT_IDX = I.IDX
	</sql>
	
	<!-- 设备点检统计，以日历方式显示点检情况 -->
	<sql id="queryToStatistic">
		<!-- 漏检统计 -->
		SELECT
			(T2.EQUIPMENT_CODE || T1.UNCHECK_DATE) AS ID,
			'漏检' AS TITLE,
			'#FF0000' AS COLOR,
			'#FFFFFF' AS TEXT_COLOR,
			TO_CHAR(T1.UNCHECK_DATE, 'YYYY-MM-DD HH24:MI') AS "START",
			CONCAT(TO_CHAR(T1.UNCHECK_DATE, 'YYYY-MM-DD'), ' 23:59') AS END,
			1 AS "ALLDAY" 
		FROM
			E_SBJX_POINT_CHECK_OMIT T1,
			E_EQUIPMENT_PRIMARY_INFO T2 
		WHERE
			T1.EQUIPMENT_IDX = T2.IDX 
			AND TO_CHAR(T1.UNCHECK_DATE, 'YYYY-MM') = '2017-05' 
			AND T2.EQUIPMENT_CODE = '4650120003' 
			AND T2.RECORD_STATUS = 0
		
		UNION ALL
		
		
		SELECT
			(I.EQUIPMENT_CODE || T.CHECK_DATE) AS ID,
			(CASE 
				WHEN T.STATE = '已处理' THEN '已点检'
				ELSE '未处理'
			END) AS TITLE,
			(CASE 
				WHEN T.STATE = '已处理' THEN '#00FF00'
				ELSE '#FFDC35'
			END) AS COLOR,
			'#000000' AS TEXT_COLOR,
			TO_CHAR(T.CHECK_DATE, 'YYYY-MM-DD HH24:MI') AS "START",
			CONCAT(TO_CHAR(T.CHECK_DATE, 'YYYY-MM-DD'), ' 23:59') AS END,
			1 AS "ALLDAY" 
		FROM
			E_SBJX_POINT_CHECK T,
			E_EQUIPMENT_PRIMARY_INFO I
		WHERE
			T.RECORD_STATUS = 0
			AND I.RECORD_STATUS = 0
			AND T.EQUIPMENT_IDX = I.IDX
			AND TO_CHAR(T.CHECK_DATE, 'YYYY-MM') = '2017-05' 
			AND I.EQUIPMENT_CODE = '4650120003'
      
 
      
 
      
 
	</sql>
	
	<!-- 设备点检处理分页查询 -->
	<sql id="queryPageList">
		SELECT
			T.IDX,
			T.EQUIPMENT_IDX,
			T.CHECK_EMP_ID,
			T.CHECK_EMP,
			T.CHECK_DATE,
			T.CHECK_TIME,
			T.CAL_RUNNING_TIME,
			T.RUNNING_TIME,
			T.EQUIPMENT_STATE,
			T.STATE,
			A.EQUIPMENT_CODE,
			A.EQUIPMENT_NAME,
			A.CLASS_CODE,
			A.CLASS_NAME,
			A.USE_PLACE,
			A.USE_WORKSHOP,
			A.USE_WORKSHOP_ID,
			A.USE_PERSON,
			A.USE_PERSON_ID,
			A.MECHANICAL_REPAIR_TEAM,
			A.MECHANICAL_REPAIR_TEAM_ID,
			A.MECHANICAL_REPAIR_PERSON,
			A.MECHANICAL_REPAIR_PERSON_ID,
			A.ELECTRIC_REPAIR_TEAM,
			A.ELECTRIC_REPAIR_TEAM_ID,
			A.ELECTRIC_REPAIR_PERSON,
			A.ELECTRIC_REPAIR_PERSON_ID,
			A.RUNING_SHIFTS,
			A.MODEL,
			A.SPECIFICATION,
			A.MANAGE_CLASS,
			A.MANAGE_LEVEL,
			A.FIXED_ASSET_NO,
			A.ORG_ID,
			A.ORG_NAME,
			A.ELECTRIC_COEFFICIENT,
			A.MECHANICAL_COEFFICIENT
		FROM
			E_EQUIPMENT_PRIMARY_INFO A,
			E_SBJX_POINT_CHECK T
		WHERE
			T.RECORD_STATUS = 0
		AND A.RECORD_STATUS = 0
		AND A.IDX = T.EQUIPMENT_IDX
		AND DATE_FORMAT(T.CHECK_DATE, '%Y-%M') = '2016-11'
	</sql>
</SqlMap>